# Hybrid A* Planner Test Scripts

This directory contains test scripts for the Hybrid A* planner implementation.

## Test Scripts

### 1. Basic Tests

- `test_hybrid_astar.py`: Tests the A* planner with a custom map with maze-like obstacles.
- `test_astar_config.py`: Tests the config method and map updates with different parameters.
- `test_map_data_format.py`: Demonstrates how to use the map_data dictionary format as provided in the original query.

### 2. Integration Tests

- `test_realtime_astar.py`: Integration test that connects to the realtime_mapper node and plans paths based on the received map.

## Map Data Format

The A* planner uses a map data dictionary with the following format:

```python
map_data = {
    'resolution': 0.5,  # meters per grid cell
    'width': 500,       # number of cells in x direction
    'height': 500,      # number of cells in y direction
    'origin': (0.0, 0.0),  # [x, y] world coordinates of bottom-left corner
    'data': np.array(...).flatten()  # flattened cost map data (0-100)
}
```

## Running the Tests

### Individual Test Scripts

You can run any of the test scripts directly:

```bash
# Make sure the script is executable
chmod +x test_hybrid_astar.py

# Run the script
./test_hybrid_astar.py
```

Or using ROS2 run:

```bash
ros2 run sensor_fusion test_hybrid_astar.py
```

### Integration with Realtime Mapper

To test with the realtime mapper, use the provided launch file:

```bash
ros2 launch sensor_fusion astar_planning.launch.py
```

This will start:
1. The realtime mapper node
2. The Hybrid A* planner node
3. The test_realtime_astar node that connects them

## Configuration Parameters

You can adjust the following parameters in the launch file:

- `map_topic`: Topic for the realtime map (default: `/realtime_map`)
- `grid_size`: Grid size for A* planning in meters (default: `0.5`)
- `obstacle_threshold`: Threshold for considering a cell as an obstacle (default: `50`)

Example with custom parameters:

```bash
ros2 launch sensor_fusion astar_planning.launch.py grid_size:=0.25 obstacle_threshold:=60
```

## Visualizing Results

The paths generated by the Hybrid A* planner are published on the `/hybrid_astar_path` topic as `nav_msgs/Path` messages. You can visualize these in RViz by:

1. Adding a Path display
2. Setting the topic to `/hybrid_astar_path`
3. Setting the fixed frame to match your map frame (default: `map`)

## Creating Custom Maps

You can create custom cost maps in any of the test scripts by:

1. Creating a numpy array of size (height, width)
2. Setting values 0-100 where higher values represent higher cost/obstacles
3. Creating a map_data dictionary
4. Using `planner.update_map_from_dict(map_data)` to update the planner

Example:

```python
cost_map = np.zeros((500, 500), dtype=np.int8)
# Add obstacles (values â‰¥ obstacle_threshold are considered obstacles)
cost_map[100:300, 200:250] = 100  # A vertical wall

map_data = {
    'resolution': 0.5,
    'width': 500,
    'height': 500,
    'origin': (0.0, 0.0),
    'data': cost_map.flatten()
}

planner.update_map_from_dict(map_data)
``` 